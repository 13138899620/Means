<?php
namespace Admin\Controller;
use Think\Controller;
class IndexController extends Controller {
   /*
     * 空操作
     */
    public function _empty($name){
    	
    	$this->error('404');
    }
    
    /*
     * 管理首页
     */
    public function index(){

		if(!is_administrator()){
    		$this->error('很抱歉，您没有登录。',U('Admin/Index/login'));
    	}
 		$this->redirect('Admin/Good/index');
    }
    public function admin(){
    
    	if(!is_administrator()){
    		$this->error('很抱歉，您没有登录。',U('Admin/Index/login'));
    	}
    	$users = M('Admin')->order("id desc")->select();
    	$this->assign('users',$users);
    	$this->display();
    }
    public function login (){

    	if(is_administrator()){
    		$this->redirect('Index/index');
    	}else{
    		$this->display();
    	}		
    }
    public function checklogin(){
    
    	$User = D('User');

    	if($User->create()){
    		$username = $User->username;
    		$password = $User->password;
    		$userinfo = $User->where("username = '".$username."'")->find();

    		if($userinfo['password'] == $password && $password != null){
    			//写session
    			session('admin_auth',$userinfo,1800);
    			$data['loginip'] = get_client_ip();
    			$data['logintime'] = time();
    
    			$res = $User->where("id =  ".$userinfo['id'])->save($data);

    			if($res !== false){
    				$this->success('登录成功！', U('Admin/Index/index'));
    			}else{
    				$this->error('登陆时数据库发生错误');
    			}
    
    		}else{
    
    			$this->error('账号不存在或者密码错误!');
    		}
    	}else{
    		$this->error($User->getError());
    	}
    }
    /* 前台用户退出登录 */
    public function logout(){    	
    	
        if(is_administrator()){
            session('admin_auth',null);
            
            $this->success('退出成功！', U('Admin/Index/login'));
        } else {
            $this->redirect('login');
        }
    }
}